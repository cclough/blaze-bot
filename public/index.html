<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Blaze Test</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://js.stripe.com/v3/"></script>

  <link rel="stylesheet" href="/styles.css" />
  <script src="/app.js"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Exo+2:wght@400;700;900&family=Rajdhani:wght@400;600;700&family=Russo+One&family=Audiowide&family=Black+Ops+One&family=Bungee&family=Monoton&family=Wallpoet&family=Electrolize&family=Share+Tech+Mono&family=Iceberg&family=Faster+One&family=Megrim&family=Jura:wght@300;400;500;600;700&family=Saira+Stencil+One&family=Turret+Road:wght@200;300;400;500;700;800&family=Michroma&family=Syncopate:wght@400;700&family=Teko:wght@300;400;500;600;700&family=Squada+One&family=Aldrich&family=Quantico:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet" />

</head>
<body>


  <div class="background-container" id="background">
    <div class="cyber-grid"></div>
    <div class="glitch-overlay"></div>
    <!-- White Blood Cells will be dynamically generated by JavaScript -->
  </div>



  <div class="content-overlay" id="modal">
    <div class="content-card">
        <div class="digital-noise"></div>
        <div class="content-scroll">
            <div class="blaze-logo">
                <span class="blaze-letter b">b</span>
                <span class="blaze-letter l">l</span>
                <span class="blaze-letter a">a</span>
                <span class="blaze-letter z">z</span>
                <span class="blaze-letter e">e</span>
            </div>
            <h2 data-text="Understand Your Immune System">Understand Your Immune System</h2>
            
            <p>Run a comprehensive 48-cytokine inflammation test. Results visualized in real-time through Telegram with advanced biomarker analysis.</p>
            
            <h3>What We Measure</h3>
            <p>Our advanced panel analyzes key inflammatory markers including interleukins (IL-1β, IL-6, IL-8, IL-10), tumor necrosis factors (TNF-α), interferons (IFN-γ), and chemokines that regulate immune cell migration and activation.</p>
            
            <div class="diagram-placeholder">
                <div class="diagram-title">Cytokine Network Analysis</div>
                <div class="diagram-content">
                    <div class="node">IL-6</div>
                    <div class="node">TNF-α</div>
                    <div class="node">IL-1β</div>
                    <div class="connection"></div>
                </div>
            </div>
            
            <h3>Clinical Applications</h3>
            <p>This comprehensive inflammatory profile helps identify systemic inflammation patterns associated with autoimmune conditions, metabolic disorders, cardiovascular risk, and chronic inflammatory states. Early detection enables targeted interventions.</p>
            
            <h3>Sample Collection</h3>
            <p>Simple blood draw at our certified collection centers. Samples are processed using advanced multiplex immunoassay technology with results typically available within 3-5 business days.</p>
            
            <div class="diagram-placeholder">
                <div class="diagram-title">Processing Pipeline</div>
                <div class="diagram-content">
                    <div class="step">Collection → Processing → Analysis → Results</div>
                </div>
            </div>
            
            <h3>Personalized Insights</h3>
            <p>Your results include detailed explanations of each biomarker, reference ranges, and personalized recommendations based on your unique inflammatory signature. All data is securely transmitted through our encrypted Telegram integration.</p>
            
            <p>Advanced machine learning algorithms analyze patterns across multiple cytokines to provide comprehensive risk assessments and actionable health insights tailored to your individual profile.</p>
        </div>
        <div class="button-container">
          <!-- onclick="buyTest()" -->
            <button>
                <span>Start Test</span>
            </button>
        </div>

        <div class="box">
          <h1>Blaze Cytokine Panel</h1>
          <p>$1 donation to cover lab cost</p>
        </div>
      
    </div>
  </div>

  <div id="checkout" style="display: none;  width: 100vw; height: 100vh; top: 0; left: 0; z-index: 9999;"></div>

  


  <script>
    Telegram.WebApp.ready();
    const btn = Telegram.WebApp.MainButton;
    const boxElement = document.querySelector('.box');
    const checkoutElement = document.getElementById('checkout');
    const modalElement = document.getElementById('modal');
    const backgroundElement = document.getElementById('background');
    // const checkoutElement = document.getElementById('content-overlay');

    const stripe = Stripe('pk_test_51RSmgFHILCjSlj9r8aaZUKvBDt66nmhRiw5rNa6MbAoOC2PU2WCSfvqMkkIc8Z6KPin0bRJbuHQR0hayywU552wy00CtP4mF3r');

    btn.setText('Pay $1').show();

    btn.onClick(async () => {
      btn.showProgress();

      const tgid = Telegram.WebApp.initDataUnsafe.user.id;
      const response = await fetch(`https://blaze-bot-five.vercel.app/api/create-checkout?tgid=${tgid}`);
      const { client_secret, error } = await response.json();

      if (error) {
        console.error('Error from backend:', error);
        Telegram.WebApp.showAlert('Could not initiate payment. ' + error);
        btn.hideProgress();
        return;
      }

      if (!client_secret) {
        console.error('Client secret not received');
        Telegram.WebApp.showAlert('Could not initiate payment. Missing client secret.');
        btn.hideProgress();
        return;
      }
      
      if (boxElement) {
        boxElement.style.display = 'none';
        modalElement.style.display = 'none';
        backgroundElement.style.display = 'none';
      }
      checkoutElement.style.display = 'block';
      btn.hide();

      try {
        const checkout = await stripe.initEmbeddedCheckout({
          clientSecret: client_secret,
        });

        checkout.mount('#checkout');
      } catch (e) {
        console.error('Error mounting Stripe checkout:', e);
        Telegram.WebApp.showAlert('Could not display payment form. ' + e.message);
        if (boxElement) boxElement.style.display = 'block';
        checkoutElement.style.display = 'none';
        btn.setText('Pay $1').show();
        btn.hideProgress();
      }
    });
  </script>
</body>
</html>