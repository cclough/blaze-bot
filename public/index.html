<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BloodX - Background</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #000000;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            position: relative;
        }

        .background-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at center, #111111 0%, #000000 100%);
        }

        /* Glitch overlay effect */
        .glitch-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent 98%, 
                rgba(255,255,255,0.02) 99%, 
                transparent 100%);
            animation: scan-lines 3s linear infinite;
            pointer-events: none;
        }

        @keyframes scan-lines {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100vw); }
        }

        /* White Blood Cell Base */
        .wbc {
            position: absolute;
            border: 2px solid rgba(170,170,170,0.4); /* Reduced opacity from #aaaaaa to make less prominent */
            filter: drop-shadow(0 0 4px rgba(255,255,255,0.15)); /* Reduced from 0.25 to 0.15 */
            animation-fill-mode: forwards;
            opacity: 0.95; /* clearly visible */
        }

        /* Macrophage - Hyper-aggressive, extremely motile phagocytic cells */
        .macrophage {
            width: 40px; /* 50% of 80px */
            height: 38px; /* 50% of 75px */
            border: 2px solid rgba(204,204,204,0.4); /* Reduced opacity */
            border-radius: 90% 10% 15% 85% / 20% 95% 80% 5%;
            background: 
                radial-gradient(circle at 40% 40%, #2a2a2a 15%, transparent 20%), /* Dark gray nucleus */
                radial-gradient(ellipse at 30% 30%, rgba(255,255,255,0.08) 30%, transparent 60%), /* Cytoplasm highlight */
                rgba(255,255,255,0.04); /* Base cytoplasm color */
            position: relative;
            box-shadow: inset 0 0 10px rgba(255,255,255,0.1); /* Inner glow for cytoplasm */
        }

        .macrophage::before {
            content: '';
            position: absolute;
            width: 10px; /* 50% of 20px */
            height: 10px; /* 50% of 20px */
            background: #2a2a2a; /* Prominent gray nucleus */
            border: 1px solid #3a3a3a;
            border-radius: 98% 2% 90% 10% / 15% 98% 2% 85%;
            top: 14px; /* 50% of 28px */
            left: 14px; /* 50% of 28px */
            box-shadow: 0 0 8px rgba(42,42,42,0.8);
            animation: nucleus-pulse 4s ease-in-out infinite;
        }

        .macrophage::after {
            /* Remove second nucleus part - single prominent nucleus like diagram */
            display: none;
        }

        /* Enhanced pseudopods to look more like diagram */
        .macrophage .pseudopod {
            position: absolute;
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(170,170,170,0.3); /* Reduced opacity */
            box-shadow: inset 0 0 3px rgba(255,255,255,0.1);
        }

        .macrophage .pseudopod:nth-child(1) {
            width: 19px; /* 50% of 38px */
            height: 6px; /* 50% of 12px */
            border-radius: 0 98% 98% 0 / 0 90% 90% 0; /* More organic shape */
            top: 5px; /* 50% of 10px */
            right: -11px; /* 50% of -22px */
            animation: pseudopod-extend 2.8s ease-in-out infinite alternate; /* Added alternate */
        }

        .macrophage .pseudopod:nth-child(2) {
            width: 11px; /* 50% of 22px */
            height: 4px; /* 50% of 8px */
            border-radius: 98% 0 0 98% / 80% 0 0 80%;
            bottom: 8px; /* 50% of 15px */
            left: -8px; /* 50% of -15px */
            animation: pseudopod-extend 2.5s ease-in-out infinite 0.4s alternate; /* Added alternate */
        }

        .macrophage .pseudopod:nth-child(3) {
            width: 15px; /* 50% of 30px */
            height: 4px; /* 50% of 7px */
            border-radius: 0 90% 90% 0 / 0 98% 98% 0;
            top: 25px; /* 50% of 50px */
            right: -9px; /* 50% of -18px */
            animation: pseudopod-extend 3.2s ease-in-out infinite 0.8s alternate; /* Added alternate */
        }

        .macrophage .pseudopod:nth-child(4) {
            width: 14px; /* 50% of 28px */
            height: 5px; /* 50% of 9px */
            border-radius: 85% 0 0 85% / 95% 0 0 95%;
            top: 10px; /* 50% of 20px */
            left: -9px; /* 50% of -18px */
            animation: pseudopod-extend 2.2s ease-in-out infinite 1.2s alternate; /* Added alternate */
        }

        .macrophage .pseudopod:nth-child(5) {
            width: 10px; /* 50% of 20px */
            height: 3px; /* 50% of 6px */
            border-radius: 0 95% 95% 0 / 0 75% 75% 0;
            bottom: 20px; /* 50% of 40px */
            right: -6px; /* 50% of -12px */
            animation: pseudopod-extend 3.8s ease-in-out infinite 1.6s alternate; /* Added alternate */
        }
        .macrophage .pseudopod:nth-child(6) { /* New pseudopod */
            width: 13px; /* 50% of 25px */
            height: 4px; /* 50% of 7px */
            border-radius: 90% 0 0 90% / 80% 0 0 80%;
            bottom: 3px; /* 50% of 5px */
            left: -5px; /* 50% of -10px */
            animation: pseudopod-extend 2.9s ease-in-out infinite 2s alternate; /* Added alternate */
        }

        /* More dynamic vesicles/organelles for macrophages */
        .macrophage .vesicle {
            position: absolute;
            width: 3px; /* 50% of 5px */
            height: 3px; /* 50% of 5px */
            background: rgba(255,255,255,0.018); /* More visible */
            border-radius: 80% 20% 30% 70%; /* Irregular shape */
            animation: vesicle-float 5s ease-in-out infinite alternate; /* Added alternate */
        }

        .macrophage .vesicle:nth-child(7) { top: 9px; left: 6px; animation-delay: 0.2s; } /* 50% of original positions */
        .macrophage .vesicle:nth-child(8) { top: 29px; left: 21px; animation-delay: 1.8s; }
        .macrophage .vesicle:nth-child(9) { top: 19px; left: 34px; animation-delay: 3.5s; }
        .macrophage .vesicle:nth-child(10) { top: 35px; left: 13px; animation-delay: 4.2s; }

        /* Lymphocyte - Small highly motile amoeba-like cells */
        .lymphocyte {
            width: 28px; /* 50% of 55px */
            height: 30px; /* 50% of 60px */
            border: 2px solid rgba(187,187,187,0.4); /* Reduced opacity */
            border-radius: 80% 20% 90% 10% / 10% 85% 20% 90%;
            background: 
                radial-gradient(circle at 40% 40%, #333333 20%, transparent 25%), /* Large gray nucleus */
                rgba(255,255,255,0.05); /* Light cytoplasm */
            position: relative;
            box-shadow: inset 0 0 8px rgba(255,255,255,0.08);
        }

        .lymphocyte::before {
            content: '';
            position: absolute;
            width: 11px; /* 50% of 22px */
            height: 11px; /* 50% of 22px */
            background: #333333; /* Large prominent gray nucleus */
            border: 1px solid #444444;
            border-radius: 90% 10% 70% 30% / 20% 80% 30% 70%;
            top: 8px; /* 50% of 16px */
            left: 8px; /* 50% of 16px */
            box-shadow: 0 0 6px rgba(51,51,51,0.8);
            animation: nucleus-pulse 3.5s ease-in-out infinite;
        }

        /* Hyper-extended small pseudopods for lymphocytes */
        .lymphocyte .mini-pod {
            position: absolute;
            background: rgba(255,255,255,0.01);
            border: 1px solid rgba(119,119,119,0.4); /* Reduced opacity */
        }

        .lymphocyte .mini-pod:nth-child(1) {
            width: 9px; /* 50% of 18px */
            height: 3px; /* 50% of 6px */
            border-radius: 0 90% 90% 0 / 0 95% 95% 0;
            top: 3px; /* 50% of 5px */
            right: -6px; /* 50% of -12px */
            animation: mini-pod-wiggle 2.0s ease-in-out infinite alternate;
        }

        .lymphocyte .mini-pod:nth-child(2) {
            width: 6px; /* 50% of 12px */
            height: 3px; /* 50% of 5px */
            border-radius: 90% 0 0 90% / 80% 0 0 80%;
            bottom: 5px; /* 50% of 10px */
            left: -4px; /* 50% of -8px */
            animation: mini-pod-wiggle 2.5s ease-in-out infinite 0.3s alternate;
        }

        .lymphocyte .mini-pod:nth-child(3) {
            width: 8px; /* 50% of 15px */
            height: 2px; /* 50% of 4px */
            border-radius: 0 95% 95% 0 / 0 85% 85% 0;
            top: 20px; /* 50% of 40px */
            right: -5px; /* 50% of -9px */
            animation: mini-pod-wiggle 2.8s ease-in-out infinite 0.6s alternate;
        }

        .lymphocyte .mini-pod:nth-child(4) {
            width: 5px; /* 50% of 10px */
            height: 3px; /* 50% of 5px */
            border-radius: 80% 0 0 80% / 90% 0 0 90%;
            top: 8px; /* 50% of 15px */
            left: -4px; /* 50% of -7px */
            animation: mini-pod-wiggle 2.3s ease-in-out infinite 0.9s alternate;
        }
         .lymphocyte .mini-pod:nth-child(5) { /* New pseudopod */
            width: 7px; /* 50% of 14px */
            height: 2px; /* 50% of 4px */
            border-radius: 0 85% 85% 0 / 0 90% 90% 0;
            bottom: 13px; /* 50% of 25px */
            right: -3px; /* 50% of -6px */
            animation: mini-pod-wiggle 2.6s ease-in-out infinite 1.2s alternate;
        }

        /* Neutrophil - Medium highly aggressive phagocytic cells */
        .neutrophil {
            width: 38px; /* 50% of 75px */
            height: 40px; /* 50% of 80px */
            border: 2px solid rgba(187,187,187,0.4); /* Reduced opacity */
            border-radius: 70% 30% 80% 20% / 25% 70% 15% 80%;
            background: 
                radial-gradient(ellipse at 35% 35%, #2d2d2d 12%, transparent 18%), /* Multi-lobed nucleus hint */
                radial-gradient(ellipse at 50% 50%, #2d2d2d 10%, transparent 15%),
                rgba(255,255,255,0.045);
            position: relative;
            box-shadow: inset 0 0 9px rgba(255,255,255,0.09);
        }

        .neutrophil::before {
            content: '';
            position: absolute;
            width: 8px; /* 50% of 15px */
            height: 14px; /* 50% of 28px */
            background: #2d2d2d; /* Multi-lobed gray nucleus */
            border: 1px solid #3d3d3d;
            border-radius: 90% 10% 98% 2% / 20% 80% 10% 90%;
            top: 13px; /* 50% of 26px */
            left: 11px; /* 50% of 22px */
            transform: rotate(15deg);
            box-shadow: 0 0 5px rgba(45,45,45,0.7);
            animation: nucleus-pulse 4s ease-in-out infinite;
        }

        .neutrophil::after {
            content: '';
            position: absolute;
            width: 7px; /* 50% of 13px */
            height: 12px; /* 50% of 24px */
            background: #2d2d2d;
            border: 1px solid #3d3d3d;
            border-radius: 80% 20% 90% 10% / 70% 30% 20% 80%;
            top: 16px; /* 50% of 32px */
            left: 19px; /* 50% of 38px */
            transform: rotate(-20deg);
            box-shadow: 0 0 5px rgba(45,45,45,0.7);
            animation: nucleus-pulse 4s ease-in-out infinite 0.4s;
        }

        /* Hyper-aggressive granules and pseudopods for neutrophils */
        .neutrophil .granule {
            position: absolute;
            width: 2px; /* 50% of 4px */
            height: 2px; /* 50% of 4px */
            background: rgba(80,80,80,0.3); /* Gray granules */
            border: 1px solid rgba(120,120,120,0.4);
            border-radius: 50%;
            animation: granule-float 5s ease-in-out infinite alternate;
        }

        .neutrophil .granule:nth-child(1) { top: 8px; left: 20px; animation-delay: 0.1s; } /* 50% of original positions */
        .neutrophil .granule:nth-child(2) { top: 25px; left: 15px; animation-delay: 1.3s; }
        .neutrophil .granule:nth-child(3) { top: 30px; left: 28px; animation-delay: 2.8s; }
        .neutrophil .granule:nth-child(4) { top: 15px; left: 30px; animation-delay: 4.2s; }
        .neutrophil .granule:nth-child(5) { top: 35px; left: 19px; animation-delay: 0.8s; }
        .neutrophil .granule:nth-child(6) { top: 11px; left: 9px; animation-delay: 2.1s; }
        .neutrophil .granule:nth-child(7) { top: 20px; left: 35px; animation-delay: 3.3s; }
        .neutrophil .granule:nth-child(8) { top: 38px; left: 10px; animation-delay: 5s; }

        /* More prominent attack pseudopods for neutrophils */
        .neutrophil .attack-pod {
            position: absolute;
            background: rgba(255,255,255,0.008); /* Dimmer */
            border: 1px solid rgba(102,102,102,0.4); /* Reduced opacity */
        }

        .neutrophil .attack-pod:nth-child(9) { /* Adjusted child index due to more granules */
            width: 16px; /* 50% of 32px */
            height: 4px; /* 50% of 7px */
            border-radius: 0 95% 95% 0 / 0 90% 90% 0;
            top: 9px; /* 50% of 18px */
            right: -10px; /* 50% of -20px */
            animation: attack-extend 2.2s ease-in-out infinite alternate;
        }

        .neutrophil .attack-pod:nth-child(10) { /* Adjusted child index */
            width: 14px; /* 50% of 28px */
            height: 3px; /* 50% of 6px */
            border-radius: 90% 0 0 90% / 85% 0 0 85%;
            bottom: 11px; /* 50% of 22px */
            left: -9px; /* 50% of -18px */
            animation: attack-extend 2.0s ease-in-out infinite 0.6s alternate;
        }
        .neutrophil .attack-pod:nth-child(11) { /* New attack-pod */
            width: 13px; /* 50% of 25px */
            height: 3px; /* 50% of 5px */
            border-radius: 0 90% 90% 0 / 0 80% 80% 0;
            top: 33px; /* 50% of 65px */
            right: -8px; /* 50% of -15px */
            animation: attack-extend 2.5s ease-in-out infinite 1.1s alternate;
        }

        /* Monocyte - Large extremely aggressive phagocytic cells */
        .monocyte {
            width: 45px; /* 50% of 90px */
            height: 48px; /* 50% of 95px */
            border: 2px solid rgba(170,170,170,0.4); /* Reduced opacity */
            border-radius: 10% 90% 20% 80% / 70% 30% 90% 10%;
            background: 
                radial-gradient(ellipse at 30% 30%, #282828 18%, transparent 25%), /* Large gray kidney-shaped nucleus */
                rgba(255,255,255,0.04);
            position: relative;
            box-shadow: inset 0 0 12px rgba(255,255,255,0.1);
        }

        .monocyte::before {
            content: '';
            position: absolute;
            width: 18px; /* 50% of 35px */
            height: 13px; /* 50% of 25px */
            background: #282828; /* Gray kidney-shaped nucleus */
            border: 1px solid #383838;
            border-radius: 20% 80% 2% 98% / 80% 20% 98% 2%;
            top: 18px; /* 50% of 35px */
            left: 13px; /* 50% of 25px */
            box-shadow: 0 0 8px rgba(40,40,40,0.8);
            animation: nucleus-pulse 5s ease-in-out infinite;
        }

        /* Hyper-massive pseudopods for monocytes */
        .monocyte .large-pod {
            position: absolute;
            background: rgba(255,255,255,0.01); /* Dimmer */
            border: 1px solid rgba(85,85,85,0.4); /* Reduced opacity */
        }

        .monocyte .large-pod:nth-child(1) {
            width: 23px; /* 50% of 45px */
            height: 8px; /* 50% of 16px */
            border-radius: 0 98% 98% 0 / 0 80% 80% 0;
            top: 8px; /* 50% of 15px */
            right: -13px; /* 50% of -25px */
            animation: large-pod-flow 3.8s ease-in-out infinite alternate;
        }

        .monocyte .large-pod:nth-child(2) {
            width: 18px; /* 50% of 35px */
            height: 7px; /* 50% of 14px */
            border-radius: 90% 0 0 90% / 70% 0 0 70%;
            bottom: 10px; /* 50% of 20px */
            left: -10px; /* 50% of -20px */
            animation: large-pod-flow 3.5s ease-in-out infinite 0.5s alternate;
        }

        .monocyte .large-pod:nth-child(3) {
            width: 15px; /* 50% of 30px */
            height: 6px; /* 50% of 12px */
            border-radius: 0 92% 92% 0 / 0 88% 88% 0;
            top: 35px; /* 50% of 70px */
            right: -9px; /* 50% of -18px */
            animation: large-pod-flow 4.2s ease-in-out infinite 1s alternate;
        }

        .monocyte .large-pod:nth-child(4) {
            width: 17px; /* 50% of 33px */
            height: 7px; /* 50% of 13px */
            border-radius: 85% 0 0 85% / 75% 0 0 75%;
            top: 15px; /* 50% of 30px */
            left: -10px; /* 50% of -19px */
            animation: large-pod-flow 3.2s ease-in-out infinite 1.5s alternate;
        }

        .monocyte .large-pod:nth-child(5) {
            width: 13px; /* 50% of 25px */
            height: 5px; /* 50% of 10px */
            border-radius: 0 88% 88% 0 / 0 92% 92% 0;
            bottom: 28px; /* 50% of 55px */
            right: -8px; /* 50% of -16px */
            animation: large-pod-flow 4.5s ease-in-out infinite 2s alternate;
        }
        .monocyte .large-pod:nth-child(6) { /* New pseudopod */
            width: 14px; /* 50% of 28px */
            height: 5px; /* 50% of 9px */
            border-radius: 95% 0 0 95% / 80% 0 0 80%;
            top: 3px; /* 50% of 5px */
            left: -6px; /* 50% of -12px */
            animation: large-pod-flow 3.9s ease-in-out infinite 2.5s alternate;
        }
         .monocyte .large-pod:nth-child(7) { /* New pseudopod */
            width: 10px; /* 50% of 20px */
            height: 4px; /* 50% of 7px */
            border-radius: 0 90% 90% 0 / 0 80% 80% 0;
            bottom: 3px; /* 50% of 5px */
            right: -4px; /* 50% of -8px */
            animation: large-pod-flow 4.8s ease-in-out infinite 3s alternate;
        }

        /* More internal organelles for monocytes */
        .monocyte .organelle {
            position: absolute;
            width: 3px; /* 50% of 6px */
            height: 3px; /* 50% of 6px */
            background: rgba(60,60,60,0.4); /* Gray internal structures */
            border: 1px solid rgba(100,100,100,0.5);
            border-radius: 50%;
            animation: vesicle-float 4s ease-in-out infinite alternate;
        }

        .monocyte .organelle:nth-child(8) { top: 11px; left: 9px; animation-delay: 0.3s; } /* 50% of original positions */
        .monocyte .organelle:nth-child(9) { top: 31px; left: 24px; animation-delay: 2.2s; }
        .monocyte .organelle:nth-child(10) { top: 24px; left: 36px; animation-delay: 4.5s; }
        .monocyte .organelle:nth-child(11) { top: 39px; left: 11px; animation-delay: 1s; }
        .monocyte .organelle:nth-child(12) { top: 5px; left: 28px; animation-delay: 3s; }
        .monocyte .organelle:nth-child(13) { top: 45px; left: 20px; animation-delay: 5.5s; }

        /* Enhanced Glitch effects */
        .glitch {
            filter: drop-shadow(0 0 3px rgba(255,255,255,0.1)) contrast(1.3);
            /* Remove conflicting animations - movement takes priority */
        }

        .glitch-intense {
            filter: drop-shadow(0 0 8px rgba(255,255,255,0.15)) contrast(1.5) saturate(0);
            /* Remove conflicting animations - movement takes priority */
        }

        /* Size variants for each cell type */
        /* Tiny variants (50% smaller than smallest) */
        .macrophage.tiny { width: 20px; height: 19px; } /* 50% of 40px/38px */
        .macrophage.tiny::before { width: 5px; height: 5px; top: 7px; left: 7px; } /* 50% of 10px/10px/14px/14px */
        .lymphocyte.tiny { width: 14px; height: 15px; } /* 50% of 28px/30px */
        .lymphocyte.tiny::before { width: 6px; height: 6px; top: 4px; left: 4px; } /* 50% of 11px/11px/8px/8px */
        .neutrophil.tiny { width: 19px; height: 20px; } /* 50% of 38px/40px */
        .neutrophil.tiny::before { width: 4px; height: 7px; top: 7px; left: 6px; } /* 50% of 8px/14px/13px/11px */
        .neutrophil.tiny::after { width: 4px; height: 6px; top: 8px; left: 10px; } /* 50% of 7px/12px/16px/19px */
        .monocyte.tiny { width: 23px; height: 24px; } /* 50% of 45px/48px */
        .monocyte.tiny::before { width: 9px; height: 7px; top: 9px; left: 7px; } /* 50% of 18px/13px/18px/13px */
        
        /* Small variants */
        .macrophage.small { width: 30px; height: 28px; } /* 50% of 60px/56px */
        .macrophage.small::before { width: 8px; height: 8px; top: 11px; left: 11px; } /* 50% of 15px/15px/21px/21px */
        .lymphocyte.small { width: 21px; height: 23px; } /* 50% of 41px/45px */
        .lymphocyte.small::before { width: 8px; height: 8px; top: 6px; left: 6px; } /* 50% of 16px/16px/12px/12px */
        .neutrophil.small { width: 28px; height: 30px; } /* 50% of 56px/60px */
        .neutrophil.small::before { width: 6px; height: 11px; top: 10px; left: 8px; } /* 50% of 11px/21px/20px/16px */
        .neutrophil.small::after { width: 5px; height: 9px; top: 12px; left: 14px; } /* 50% of 10px/18px/24px/28px */
        .monocyte.small { width: 34px; height: 36px; } /* 50% of 68px/71px */
        .monocyte.small::before { width: 13px; height: 10px; top: 13px; left: 10px; } /* 50% of 26px/19px/26px/19px */
        
        /* Medium variants (original sizes - now 50% smaller) */
        .macrophage.medium { width: 40px; height: 38px; } /* Already updated above */
        .lymphocyte.medium { width: 28px; height: 30px; } /* Already updated above */
        .neutrophil.medium { width: 38px; height: 40px; } /* Already updated above */
        .monocyte.medium { width: 45px; height: 48px; } /* Already updated above */
        
        /* Large variants (increased by 40% from current sizes) */
        .macrophage.large { width: 70px; height: 66px; } /* 40% larger: 50*1.4=70px, 47*1.4=66px */
        .macrophage.large::before { width: 18px; height: 18px; top: 25px; left: 25px; } /* 40% larger: 13*1.4=18px, 18*1.4=25px */
        .lymphocyte.large { width: 49px; height: 53px; } /* 40% larger: 35*1.4=49px, 38*1.4=53px */
        .lymphocyte.large::before { width: 20px; height: 20px; top: 14px; left: 14px; } /* 40% larger: 14*1.4=20px, 10*1.4=14px */
        .neutrophil.large { width: 66px; height: 70px; } /* 40% larger: 47*1.4=66px, 50*1.4=70px */
        .neutrophil.large::before { width: 14px; height: 25px; top: 22px; left: 20px; } /* 40% larger: 10*1.4=14px, 18*1.4=25px, 16*1.4=22px, 14*1.4=20px */
        .neutrophil.large::after { width: 11px; height: 21px; top: 28px; left: 34px; } /* 40% larger: 8*1.4=11px, 15*1.4=21px, 20*1.4=28px, 24*1.4=34px */
        .monocyte.large { width: 80px; height: 84px; } /* 40% larger: 57*1.4=80px, 60*1.4=84px */
        .monocyte.large::before { width: 31px; height: 22px; top: 31px; left: 22px; } /* 40% larger: 22*1.4=31px, 16*1.4=22px */
        
        /* Huge variants (increased by 40% from current sizes) */
        .macrophage.huge { width: 77px; height: 73px; } /* 40% larger: 55*1.4=77px, 52*1.4=73px */
        .macrophage.huge::before { width: 20px; height: 20px; top: 27px; left: 27px; } /* 40% larger: 14*1.4=20px, 19*1.4=27px */
        .lymphocyte.huge { width: 53px; height: 59px; } /* 40% larger: 38*1.4=53px, 42*1.4=59px */
        .lymphocyte.huge::before { width: 22px; height: 22px; top: 17px; left: 17px; } /* 40% larger: 16*1.4=22px, 12*1.4=17px */
        .neutrophil.huge { width: 73px; height: 77px; } /* 40% larger: 52*1.4=73px, 55*1.4=77px */
        .neutrophil.huge::before { width: 14px; height: 28px; top: 25px; left: 22px; } /* 40% larger: 10*1.4=14px, 20*1.4=28px, 18*1.4=25px, 16*1.4=22px */
        .neutrophil.huge::after { width: 13px; height: 24px; top: 31px; left: 36px; } /* 40% larger: 9*1.4=13px, 17*1.4=24px, 22*1.4=31px, 26*1.4=36px */
        .monocyte.huge { width: 87px; height: 91px; } /* 40% larger: 62*1.4=87px, 65*1.4=91px */
        .monocyte.huge::before { width: 35px; height: 24px; top: 35px; left: 24px; } /* 40% larger: 25*1.4=35px, 17*1.4=24px */

        /* Morphing animations for phagocytic shapes */
        @keyframes morph-phagocyte {
            0%, 100% { 
                border-radius: 80% 20% 30% 70% / 40% 80% 60% 20%;
                transform: scale(1) rotate(0deg);
            }
            20% { 
                border-radius: 20% 80% 70% 30% / 80% 20% 40% 60%;
                transform: scale(1.08) rotate(1deg);
            }
            40% { 
                border-radius: 70% 30% 20% 80% / 30% 70% 80% 20%;
                transform: scale(0.92) rotate(-2deg);
            }
            60% { 
                border-radius: 30% 70% 80% 20% / 70% 30% 20% 80%;
                transform: scale(1.05) rotate(1deg);
            }
            80% { 
                border-radius: 60% 40% 30% 70% / 20% 80% 70% 30%;
                transform: scale(0.97) rotate(-1deg);
            }
        }

        @keyframes morph-amoeba {
            0%, 100% { border-radius: 70% 30% 80% 20% / 30% 70% 20% 80%; }
            25% { border-radius: 30% 70% 20% 80% / 80% 20% 70% 30%; }
            50% { border-radius: 80% 20% 30% 70% / 20% 80% 30% 70%; }
            75% { border-radius: 20% 80% 70% 30% / 70% 30% 80% 20%; }
        }

        @keyframes morph-neutrophil {
            0%, 100% { border-radius: 60% 40% 70% 30% / 40% 60% 30% 70%; }
            33% { border-radius: 40% 60% 30% 70% / 70% 30% 60% 40%; }
            66% { border-radius: 70% 30% 40% 60% / 30% 70% 40% 60%; }
        }

        @keyframes morph-monocyte {
            0%, 100% { border-radius: 20% 80% 30% 70% / 60% 40% 80% 20%; }
            16% { border-radius: 80% 20% 70% 30% / 40% 60% 20% 80%; }
            33% { border-radius: 30% 70% 20% 80% / 80% 20% 60% 40%; }
            50% { border-radius: 70% 30% 80% 20% / 20% 80% 40% 60%; }
            66% { border-radius: 40% 60% 30% 70% / 70% 30% 20% 80%; }
            83% { border-radius: 60% 40% 70% 30% / 30% 70% 80% 20%; }
        }

        /* Pseudopod animations */
        @keyframes pseudopod-extend {
            0%, 100% { 
                transform: scaleX(0.8) scaleY(0.7) translateX(2px); /* Retracted further */
                opacity: 0.3;
            }
            50% { 
                transform: scaleX(1.5) scaleY(1.3) translateX(-5px); /* Extend much further */
                opacity: 1;
            }
        }

        @keyframes mini-pod-wiggle {
            0%, 100% { 
                transform: scaleX(0.7) translateX(1px); /* More retracted */
                opacity: 0.4;
            }
            50% { 
                transform: scaleX(1.4) translateX(-3px); /* Extend more */
                opacity: 0.9;
            }
        }

        @keyframes large-pod-flow {
            0%, 100% { 
                transform: scaleX(0.7) scaleY(0.6) translateX(4px); /* Retracted further */
                opacity: 0.5;
            }
            33% { 
                transform: scaleX(1.7) scaleY(0.7) translateX(-8px); /* Massive X extension */
                opacity: 1;
            }
            66% { 
                transform: scaleX(0.6) scaleY(1.5) translateX(6px); /* Massive Y extension */
                opacity: 0.4;
            }
        }

        @keyframes granule-float {
            0%, 100% { 
                transform: translate(0, 0) scale(0.8) rotate(0deg); /* Smaller base */
                opacity: 0.5;
            }
            25% { 
                transform: translate(2px, -2px) scale(1.3) rotate(45deg); /* More movement & rotation */
                opacity: 0.9;
            }
            50% { 
                transform: translate(-2px, 2px) scale(0.7) rotate(-45deg);
                opacity: 1;
            }
            75% { 
                transform: translate(1px, 2px) scale(1.2) rotate(90deg);
                opacity: 0.6;
            }
        }

        @keyframes vesicle-float {
            0%, 100% { 
                transform: translate(0, 0) scale(0.7) rotate(0deg);
                opacity: 0.4;
            }
            33% { 
                transform: translate(-3px, 2px) scale(1.4) rotate(150deg); /* More movement & rotation */
                opacity: 0.9;
            }
            66% { 
                transform: translate(3px, -2px) scale(0.6) rotate(-150deg);
                opacity: 1;
            }
        }

        @keyframes attack-extend {
            0%, 100% { 
                transform: scaleX(0.6) scaleY(0.5) translateX(3px); /* More retracted */
                opacity: 0.3;
            }
            30% { 
                transform: scaleX(1.8) scaleY(0.7) translateX(-6px); /* Much longer reach */
                opacity: 1;
            }
            70% { 
                transform: scaleX(0.5) scaleY(1.4) translateX(4px); /* Wider sweep */
                opacity: 0.5;
            }
        }

        @keyframes organelle-drift {
            0%, 100% { 
                transform: translate(0, 0) scale(0.8) rotate(0deg);
                opacity: 0.3;
            }
            25% { 
                transform: translate(-2px, -3px) scale(1.3) rotate(120deg); /* Increased movement & rotation */
                opacity: 0.8;
            }
            50% { 
                transform: translate(3px, 2px) scale(0.7) rotate(-120deg);
                opacity: 0.9;
            }
            75% { 
                transform: translate(-2px, 3px) scale(1.2) rotate(240deg);
                opacity: 0.5;
            }
        }

        /* Enhanced glitch animations */
        @keyframes nucleus-pulse {
            0%, 100% { 
                opacity: 0.9;
                transform: scale(1);
            }
            50% { 
                opacity: 1;
                transform: scale(1.05);
            }
        }

        @keyframes random-flicker {
            0%, 98%, 100% { opacity: 1; } /* Further increased stable duration */
            99% { opacity: 0.8; } /* Even softer flicker */
        }

        @keyframes random-distort {
            0%, 95%, 100% { transform: translate(0, 0) scale(1); } /* Further increased stable duration */
            96% { transform: translate(-0.2px, 0.2px) scale(1.002); } /* Even softer distort */
            98% { transform: translate(0.2px, -0.2px) scale(0.998); }
        }

        @keyframes intense-glitch {
            0%, 80%, 100% { /* Further increased stable duration */
                transform: translate(0, 0) skew(0deg);
                filter: contrast(1);
            }
            90% { 
                transform: translate(-0.5px, 0.5px) skew(0.1deg); /* Even softer glitch */
                filter: contrast(1.2);
            }
        }

        @keyframes opacity-flicker {
            0%, 99%, 100% { opacity: inherit; } /* Further increased stable duration */
            /* Glitch very rarely */
        }

        /* Multi-directional float animations - will be assigned randomly via JS */
        @keyframes float-left-to-right {
            0% { 
                transform: translateX(-120px) rotate(0deg); 
                opacity: 0;
            }
            10% { opacity: 0.4; }
            90% { opacity: 0.4; }
            100% { 
                transform: translateX(calc(100vw + 120px)) rotate(360deg); 
                opacity: 0;
            }
        }

        @keyframes float-right-to-left {
            0% { 
                transform: translateX(calc(100vw + 120px)) rotate(0deg); 
                opacity: 0;
            }
            10% { opacity: 0.4; }
            90% { opacity: 0.4; }
            100% { 
                transform: translateX(-120px) rotate(-360deg); 
                opacity: 0;
            }
        }

        @keyframes float-top-to-bottom {
            0% { 
                transform: translateY(-100px) rotate(0deg); 
                opacity: 0;
            }
            15% { opacity: 0.3; }
            85% { opacity: 0.3; }
            100% { 
                transform: translateY(calc(100vh + 100px)) rotate(270deg); 
                opacity: 0;
            }
        }

        @keyframes float-bottom-to-top {
            0% { 
                transform: translateY(calc(100vh + 100px)) rotate(0deg); 
                opacity: 0;
            }
            15% { opacity: 0.3; }
            85% { opacity: 0.3; }
            100% { 
                transform: translateY(-100px) rotate(-270deg); 
                opacity: 0;
            }
        }

        @keyframes float-diagonal-1 {
            0% { 
                transform: translate(-100px, -100px) rotate(0deg); 
                opacity: 0;
            }
            12% { opacity: 0.35; }
            88% { opacity: 0.35; }
            100% { 
                transform: translate(calc(100vw + 100px), calc(100vh + 100px)) rotate(450deg); 
                opacity: 0;
            }
        }

        @keyframes float-diagonal-2 {
            0% { 
                transform: translate(calc(100vw + 100px), -100px) rotate(0deg); 
                opacity: 0;
            }
            12% { opacity: 0.35; }
            88% { opacity: 0.35; }
            100% { 
                transform: translate(-100px, calc(100vh + 100px)) rotate(-450deg); 
                opacity: 0;
            }
        }

        /* Positioning and timing handled dynamically by JavaScript */

        /* Glitch distortion effect */
        @keyframes glitch-distort {
            0%, 100% { 
                transform: translate(0);
                filter: hue-rotate(0deg);
            }
            20% { 
                transform: translate(-2px, 2px);
                filter: hue-rotate(90deg);
            }
            40% { 
                transform: translate(-2px, -2px);
                filter: hue-rotate(180deg);
            }
            60% { 
                transform: translate(2px, 2px);
                filter: hue-rotate(270deg);
            }
            80% { 
                transform: translate(2px, -2px);
                filter: hue-rotate(360deg);
            }
        }

        .glitch-periodic {
            /* Disabled to prevent movement conflicts */
        }

        /* Cyberpunk grid overlay */
        .cyber-grid {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(255,255,255,0.01) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,0.01) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: grid-pulse 8s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes grid-pulse {
            0%, 100% { opacity: 0.1; }
            50% { opacity: 0.03; }
        }

        /* Occasional glitch trigger */
        .background-container {
            animation: bg-glitch 15s infinite;
        }

        @keyframes bg-glitch {
            0%, 98% { filter: contrast(1); }
            99% { filter: contrast(1.5) brightness(1.2); }
            100% { filter: contrast(1); }
        }

        /* Add a simple rotation animation for all cells */
        @keyframes spin-cell {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Glitchy movement animations */
        @keyframes glitch-disappear {
            0%, 95% { opacity: 1; }
            96%, 98% { opacity: 0; }
            99%, 100% { opacity: 1; }
        }

        @keyframes glitch-jitter {
            0%, 90% { transform: translate(0, 0); }
            91% { transform: translate(-3px, 2px); }
            92% { transform: translate(2px, -2px); }
            93% { transform: translate(-1px, -3px); }
            94% { transform: translate(3px, 1px); }
            95% { transform: translate(-2px, 3px); }
            96%, 100% { transform: translate(0, 0); }
        }

        @keyframes glitch-teleport {
            0%, 88% { transform: translate(0, 0); opacity: 1; }
            89% { opacity: 0; }
            90% { transform: translate(-20px, -15px); }
            91% { opacity: 1; }
            92% { transform: translate(25px, 10px); }
            93% { transform: translate(-15px, 20px); }
            94% { transform: translate(10px, -25px); }
            95%, 100% { transform: translate(0, 0); opacity: 1; }
        }

        @keyframes glitch-stutter {
            0%, 85% { transform: translateX(0); }
            86% { transform: translateX(-8px); }
            87% { transform: translateX(5px); }
            88% { transform: translateX(-3px); }
            89% { transform: translateX(7px); }
            90% { transform: translateX(-2px); }
            91%, 100% { transform: translateX(0); }
        }

        /* Glitch effect classes */
        .glitch-movement {
            animation-duration: 8s !important;
            animation-iteration-count: infinite !important;
        }

        .glitch-disappear { animation-name: glitch-disappear !important; }
        .glitch-jitter { animation-name: glitch-jitter !important; }
        .glitch-teleport { animation-name: glitch-teleport !important; }
        .glitch-stutter { animation-name: glitch-stutter !important; }

        /* Content overlay styles */
        .content-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            pointer-events: none; /* Allow clicks to pass through to background */
            text-align: center;
            padding: 5rem;
        }

        .content-card {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 2rem;
            max-width: 400px;
            pointer-events: auto; /* Re-enable clicks for the card */
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        h2 {
            color: #ffffff;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-size: 1.8rem;
            font-weight: 600;
            margin: 0 0 1rem 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        p {
            color: #cccccc;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-size: 1rem;
            line-height: 1.5;
            margin: 0 0 2rem 0;
        }

        button {
            background: linear-gradient(135deg, #007aff, #0056cc);
            color: white;
            border: none;
            padding: 1rem 2rem;
            font-size: 1.2rem;
            font-weight: 600;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(0, 122, 255, 0.3);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        button:hover {
            background: linear-gradient(135deg, #0056cc, #003d99);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 122, 255, 0.4);
        }

        button:active {
            transform: translateY(0);
        }
    </style>
</head>
<body>
    <div class="background-container">
        <div class="cyber-grid"></div>
        <div class="glitch-overlay"></div>
        
        <!-- White Blood Cells will be dynamically generated by JavaScript -->
    </div>

    <script>
        // Available movement animations
        const animations = [
            'float-left-to-right',
            'float-right-to-left', 
            'float-top-to-bottom',
            'float-bottom-to-top',
            'float-diagonal-1',
            'float-diagonal-2'
        ];

        // Function to create a single WBC with its internal elements
        function createCell(type, isGlitch, isIntenseGlitch) {
            // Create wrapper for movement
            const wrapper = document.createElement('div');
            wrapper.classList.add('wbc-wrapper');
            wrapper.style.position = 'absolute';
            
            // Create the actual cell
            const wbc = document.createElement('div');
            wbc.classList.add('wbc', type);
            if (isGlitch) wbc.classList.add('glitch');
            if (isIntenseGlitch) wbc.classList.add('glitch-intense');

            let innerHTML = '';
            if (type === 'macrophage') {
                innerHTML = `
                    <div class="pseudopod"></div> <div class="pseudopod"></div> <div class="pseudopod"></div>
                    <div class="pseudopod"></div> <div class="pseudopod"></div> <div class="pseudopod"></div>
                    <div class="vesicle"></div> <div class="vesicle"></div>
                    <div class="vesicle"></div> <div class="vesicle"></div>
                `;
            } else if (type === 'lymphocyte') {
                innerHTML = `
                    <div class="mini-pod"></div> <div class="mini-pod"></div> <div class="mini-pod"></div>
                    <div class="mini-pod"></div> <div class="mini-pod"></div>
                `;
            } else if (type === 'neutrophil') {
                innerHTML = `
                    <div class="granule"></div> <div class="granule"></div> <div class="granule"></div>
                    <div class="granule"></div> <div class="granule"></div> <div class="granule"></div>
                    <div class="granule"></div> <div class="granule"></div>
                    <div class="attack-pod"></div> <div class="attack-pod"></div> <div class="attack-pod"></div>
                `;
            } else if (type === 'monocyte') {
                innerHTML = `
                    <div class="large-pod"></div> <div class="large-pod"></div> <div class="large-pod"></div>
                    <div class="large-pod"></div> <div class="large-pod"></div> <div class="large-pod"></div>
                    <div class="large-pod"></div>
                    <div class="organelle"></div> <div class="organelle"></div> <div class="organelle"></div>
                    <div class="organelle"></div> <div class="organelle"></div> <div class="organelle"></div>
                `;
            }
            wbc.innerHTML = innerHTML;
            
            // Add cell to wrapper, wrapper to container
            wrapper.appendChild(wbc);
            document.querySelector('.background-container').appendChild(wrapper);
            return wrapper; // Return wrapper, not cell
        }

        // Function to populate the screen with a calculated number of cells based on desired coverage
        function populateCells() {
            const viewportWidth = window.innerWidth;
            const viewportHeight = window.innerHeight;

            // SIMPLE APPROACH: Fixed counts that guarantee visibility - REDUCED BY 30%
            const visibleCellsInViewport = 36; // Reduced from 52 (30% reduction)
            const bufferCellsOffScreen = 21; // Reduced from 30 (30% reduction)
            const totalCellsNeeded = visibleCellsInViewport + bufferCellsOffScreen;

            const cellTypes = ['macrophage', 'lymphocyte', 'neutrophil', 'monocyte'];

            const container = document.querySelector('.background-container');
            container.querySelectorAll('.wbc').forEach(el => el.remove()); // Clear existing cells

            console.log(`Starting to create ${totalCellsNeeded} cells (${visibleCellsInViewport} in viewport, ${bufferCellsOffScreen} off-screen)`);
            let createdCount = 0;

            // First: Create cells INSIDE viewport (guaranteed visible)
            for (let i = 0; i < visibleCellsInViewport; i++) {
                const type = cellTypes[Math.floor(Math.random() * cellTypes.length)];
                const isGlitch = Math.random() < 0.15;
                const isIntenseGlitch = isGlitch && Math.random() < 0.1;

                const cell = createCell(type, isGlitch && !isIntenseGlitch, isIntenseGlitch);
                
                // Position strictly within viewport boundaries
                const randomX = Math.random() * (viewportWidth - 150); // Leave 150px margin
                const randomY = Math.random() * (viewportHeight - 150); // Leave 150px margin
                
                cell.style.left = `${randomX}px`;
                cell.style.top = `${randomY}px`;
                cell.style.position = 'absolute';
                cell.style.zIndex = '10';
                
                createdCount++;
            }

            // Second: Create buffer cells off-screen for continuous flow
            for (let i = 0; i < bufferCellsOffScreen; i++) {
                const type = cellTypes[Math.floor(Math.random() * cellTypes.length)];
                const isGlitch = Math.random() < 0.15;
                const isIntenseGlitch = isGlitch && Math.random() < 0.1;

                const cell = createCell(type, isGlitch && !isIntenseGlitch, isIntenseGlitch);
                
                // Position off-screen
                const side = Math.floor(Math.random() * 4); // 0=left, 1=right, 2=top, 3=bottom
                let randomX, randomY;
                
                if (side === 0) { // left side
                    randomX = -200 - Math.random() * 100;
                    randomY = Math.random() * viewportHeight;
                } else if (side === 1) { // right side
                    randomX = viewportWidth + 50 + Math.random() * 100;
                    randomY = Math.random() * viewportHeight;
                } else if (side === 2) { // top
                    randomX = Math.random() * viewportWidth;
                    randomY = -200 - Math.random() * 100;
                } else { // bottom
                    randomX = Math.random() * viewportWidth;
                    randomY = viewportHeight + 50 + Math.random() * 100;
                }
                
                cell.style.left = `${randomX}px`;
                cell.style.top = `${randomY}px`;
                cell.style.position = 'absolute';
                cell.style.zIndex = '10';
                
                createdCount++;
            }

            console.log(`✅ Created ${createdCount} total cells. Should see ${visibleCellsInViewport} in viewport.`);
            
            // Verify cells were actually added to DOM
            const actualCellsInDOM = container.querySelectorAll('.wbc').length;
            console.log(`🔍 DOM verification: ${actualCellsInDOM} .wbc elements found in container`);
        }

        // Function to apply glitchy movement effects to random cells
        function applyGlitchyMovement() {
            const wrappers = document.querySelectorAll('.wbc-wrapper');
            const glitchTypes = ['glitch-disappear', 'glitch-jitter', 'glitch-teleport', 'glitch-stutter'];
            
            wrappers.forEach(wrapper => {
                const wbc = wrapper.querySelector('.wbc');
                
                // 29.3% chance for a cell to have glitchy movement (30% more than 22.5%)
                if (Math.random() < 0.293) {
                    const randomGlitchType = glitchTypes[Math.floor(Math.random() * glitchTypes.length)];
                    wbc.classList.add('glitch-movement', randomGlitchType);
                    
                    // Remove glitch effect after some time and reapply later
                    setTimeout(() => {
                        wbc.classList.remove('glitch-movement', randomGlitchType);
                        
                        // Chance to reapply a different glitch later
                        if (Math.random() < 0.3) {
                            setTimeout(() => {
                                const newGlitchType = glitchTypes[Math.floor(Math.random() * glitchTypes.length)];
                                wbc.classList.add('glitch-movement', newGlitchType);
                            }, 3000 + Math.random() * 7000); // 3-10 seconds later
                        }
                    }, 8000 + Math.random() * 4000); // Remove after 8-12 seconds
                }
            });
        }

        // Generate random movement patterns and speeds for each cell
        function randomizeWBCPositions() {
            const wrappers = document.querySelectorAll('.wbc-wrapper');
            console.log(`🔄 Starting to animate ${wrappers.length} cell wrappers...`);
            
            wrappers.forEach((wrapper, index) => {
                const wbc = wrapper.querySelector('.wbc');
                
                // Remove any conflicting classes that might pause animations
                wbc.classList.remove('glitch-periodic');
                
                // Apply random size class with weighted distribution
                const sizes = ['tiny', 'small', 'medium', 'large', 'huge'];
                wbc.classList.remove(...sizes); // Remove any existing size
                
                // Weighted distribution: smaller cells more common
                const sizeRandom = Math.random();
                let randomSize;
                if (sizeRandom < 0.35) {
                    randomSize = 'tiny';      // 35% chance (increased)
                } else if (sizeRandom < 0.65) {
                    randomSize = 'small';     // 30% chance (increased)
                } else if (sizeRandom < 0.85) {
                    randomSize = 'medium';    // 20% chance (same)
                } else if (sizeRandom < 0.95) {
                    randomSize = 'large';     // 10% chance (reduced from 15%)
                } else {
                    randomSize = 'huge';      // 5% chance (reduced from 10%)
                }
                wbc.classList.add(randomSize);
                
                const randomAnimation = animations[Math.floor(Math.random() * animations.length)];
                const morphAnimation = wbc.classList.contains('macrophage') ? 'morph-phagocyte' :
                                     wbc.classList.contains('lymphocyte') ? 'morph-amoeba' :
                                     wbc.classList.contains('neutrophil') ? 'morph-neutrophil' : 'morph-monocyte';

                // VERY FAST movement for wrapper
                const baseSpeed = 12 + Math.random() * 34; // between 12s and 46s (50% slower)
                
                // Apply movement animation to WRAPPER only
                wrapper.style.animation = `${randomAnimation} ${baseSpeed}s linear infinite`;
                wrapper.style.animationDelay = '0s';
                wrapper.style.animationPlayState = 'running';
                
                // Apply morph, rotation, and scale to inner CELL
                const morphSpeed = 1 + Math.random() * 2; // between 1s and 3s
                const rotationSpeed = 10 + Math.random() * 15; // 10-25s rotation
                const rotationDirection = Math.random() < 0.5 ? 'normal' : 'reverse';
                
                // NO MORE SCALE - size is handled by CSS classes
                
                wbc.style.animation = `
                    ${morphAnimation} ${morphSpeed}s ease-in-out infinite,
                    spin-cell ${rotationSpeed}s linear infinite ${rotationDirection}
                `;
                wbc.style.animationDelay = '0s, 0s';
                wbc.style.animationPlayState = 'running';
                
                // Debug: Log size class
                if (index % 10 === 0) {
                    console.log(`Cell ${index}: size=${randomSize}, movement=${baseSpeed}s`);
                }
                
                console.log(`Cell ${index}: movement ${baseSpeed}s (wrapper), morph ${morphSpeed}s, spin ${rotationSpeed}s`);
            });
            
            console.log(`✅ Applied separated animations to all ${wrappers.length} cells`);
        }

        // Enhanced glitch effects
        function triggerRandomGlitch() {
            const glitchElements = document.querySelectorAll('.glitch, .glitch-intense');
            const randomElement = glitchElements[Math.floor(Math.random() * glitchElements.length)];
            
            if (randomElement && Math.random() < 0.45) { // Increased from 0.3 to 0.45 (50% more often)
                // Temporary super-glitch effect
                randomElement.style.filter = 'drop-shadow(0 0 10px rgba(255,255,255,0.3)) contrast(2) brightness(1.5)';
                randomElement.style.transform = `translate(${(Math.random()-0.5)*6}px, ${(Math.random()-0.5)*6}px) scale(${0.9 + Math.random()*0.2})`;
                
                setTimeout(() => {
                    randomElement.style.filter = '';
                    randomElement.style.transform = '';
                }, 100 + Math.random() * 200);
            }
        }

        // Add random static interference
        function addStaticInterference() {
            const container = document.querySelector('.background-container');
            if (Math.random() < 0.1) {
                container.style.filter = 'contrast(1.8) brightness(1.2) hue-rotate(5deg)';
                setTimeout(() => {
                    container.style.filter = '';
                }, 50 + Math.random() * 100);
            }
        }

        // Periodic cell regeneration for continuous flow
        function regenerateCell() {
            const wrappers = document.querySelectorAll('.wbc-wrapper');
            if (wrappers.length === 0) return; // Guard against no cells
            const randomWrapper = wrappers[Math.floor(Math.random() * wrappers.length)];
            const randomWBC = randomWrapper.querySelector('.wbc');
            
            // Get viewport dimensions for new position
            const viewportWidth = window.innerWidth;
            const viewportHeight = window.innerHeight;
            
            // Set new random position at edges based on animation direction
            const randomAnimation = animations[Math.floor(Math.random() * animations.length)];
            
            // Position at appropriate edge based on animation direction
            let newX, newY;
            if (randomAnimation === 'float-left-to-right') {
                newX = -120; // Start off left edge
                newY = Math.random() * viewportHeight;
            } else if (randomAnimation === 'float-right-to-left') {
                newX = viewportWidth + 120; // Start off right edge
                newY = Math.random() * viewportHeight;
            } else if (randomAnimation === 'float-top-to-bottom') {
                newX = Math.random() * viewportWidth;
                newY = -120; // Start off top edge
            } else if (randomAnimation === 'float-bottom-to-top') {
                newX = Math.random() * viewportWidth;
                newY = viewportHeight + 120; // Start off bottom edge
            } else if (randomAnimation === 'float-diagonal-1') {
                newX = -120; // Start off top-left
                newY = -120;
            } else { // float-diagonal-2
                newX = viewportWidth + 120; // Start off top-right
                newY = -120;
            }
            
            randomWrapper.style.left = `${newX}px`;
            randomWrapper.style.top = `${newY}px`;
            
            // Get morph animation based on cell type
            const morphAnimation = randomWBC.classList.contains('macrophage') ? 'morph-phagocyte' :
                                 randomWBC.classList.contains('lymphocyte') ? 'morph-amoeba' :
                                 randomWBC.classList.contains('neutrophil') ? 'morph-neutrophil' : 'morph-monocyte';
            
            // Random animation timing - FAST movement
            const baseDuration = 12 + Math.random() * 34; // 12-46s (50% slower)
            const morphDuration = 1 + Math.random() * 2;
            const rotationSpeed = 10 + Math.random() * 15;
            const rotationDirection = Math.random() < 0.5 ? 'normal' : 'reverse';
            
            // Set new animation on wrapper (movement only)
            randomWrapper.style.animation = `${randomAnimation} ${baseDuration}s linear infinite`;
            
            // Update cell animations (morph, rotation, keep scale)
            // Occasionally change size when regenerating (30% chance)
            if (Math.random() < 0.3) {
                const sizes = ['tiny', 'small', 'medium', 'large', 'huge'];
                randomWBC.classList.remove(...sizes);
                
                // Use same weighted distribution
                const sizeRandom = Math.random();
                let newSize;
                if (sizeRandom < 0.35) {
                    newSize = 'tiny';      // 35% chance
                } else if (sizeRandom < 0.65) {
                    newSize = 'small';     // 30% chance
                } else if (sizeRandom < 0.85) {
                    newSize = 'medium';    // 20% chance
                } else if (sizeRandom < 0.95) {
                    newSize = 'large';     // 10% chance
                } else {
                    newSize = 'huge';      // 5% chance
                }
                randomWBC.classList.add(newSize);
                console.log(`Regenerated cell changed to size: ${newSize}`);
            }
            
            randomWBC.style.animation = `
                ${morphAnimation} ${morphDuration}s ease-in-out infinite,
                spin-cell ${rotationSpeed}s linear infinite ${rotationDirection}
            `;
        }

        // Initialize everything
        document.addEventListener('DOMContentLoaded', () => {
            populateCells();
            randomizeWBCPositions();
            
            // Apply initial glitchy movement effects
            setTimeout(() => {
                applyGlitchyMovement();
            }, 2000); // Wait 2 seconds after initial setup
            
            setInterval(triggerRandomGlitch, 2667 + Math.random() * 2000); // 50% more often: was 4000 + Math.random() * 3000
            setInterval(addStaticInterference, 6000 + Math.random() * 4000);
            setInterval(regenerateCell, 10000 + Math.random() * 5000);
            
            // Periodically reapply glitchy movement effects - 50% more often
            setInterval(() => {
                applyGlitchyMovement();
            }, 10000 + Math.random() * 6667); // 50% more often: was 15000 + Math.random() * 10000

            // Recalculate on resize for responsiveness
            window.addEventListener('resize', () => {
                populateCells();
                randomizeWBCPositions();
                setTimeout(() => {
                    applyGlitchyMovement();
                }, 1000);
            });
        });
    </script>

    <!-- index.html  -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
    const tg = window.Telegram.WebApp;   // Mini-app bridge
    tg.expand();                         // Optional: open full height

    // Example: send data back to the bot when user clicks a button
    function sendName () {
        const name = document.getElementById('name').value;
        tg.sendData(JSON.stringify({name}));
        tg.close();                        // Close the mini-app (optional)
    }
    </script>

    <div class="content-overlay">
        <div class="content-card">
            <h2>Understand Your Immune System</h2>
            <p>Run a 48-cytokine inflammation test. Results visualized in Telegram.</p>
            <button onclick="buyTest()">Buy Test</button>
        </div>
    </div>

    <script>
    function buyTest() {
        const tgid = new URLSearchParams(window.location.search).get('tgid');
        
        if (!tgid) {
            alert('Error: No Telegram ID found. Please open this from Telegram.');
            return;
        }
        
        // Use relative URL so it works with your deployed Render app
        fetch('/api/webapp-complete', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ telegramId: tgid })
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.text();
        })
        .then(() => {
            console.log('Successfully sent to backend');
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.close(); // closes and returns to bot
            } else {
                alert("Now return to Telegram to finish checkout.");
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error processing request. Please try again.');
        });
    }
    </script>
</body>
</html>
